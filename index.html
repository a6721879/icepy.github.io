<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>农业-行者</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="iOS JavaScript Swift Objective-C 前端 HTML5">
<meta property="og:type" content="website">
<meta property="og:title" content="农业-行者">
<meta property="og:url" content="http://lcepy.github.io/index.html">
<meta property="og:site_name" content="农业-行者">
<meta property="og:description" content="iOS JavaScript Swift Objective-C 前端 HTML5">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="农业-行者">
<meta name="twitter:description" content="iOS JavaScript Swift Objective-C 前端 HTML5">
  
    <link rel="alternative" href="/atom.xml" title="农业-行者" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7qncz5.com1.z0.glb.clouddn.com/blog/mockingbird.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">icepy</a></h1>
		</hgroup>

		
		<p class="header-subtitle">曾记否，到中流击水，浪遏飞舟！</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/lcepy" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/u/2455876310" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/JavaScript/" style="font-size: 18px;">JavaScript</a> <a href="/tags/django/" style="font-size: 14px;">django</a> <a href="/tags/iOS/" style="font-size: 20px;">iOS</a> <a href="/tags/nodejs/" style="font-size: 12px;">nodejs</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/生活/" style="font-size: 16px;">生活</a> <a href="/tags/简历/" style="font-size: 10px;">简历</a> <a href="/tags/经验之谈/" style="font-size: 12px;">经验之谈</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">怅寥廓，问苍茫大地，谁主沉浮？</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">icepy</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://7qncz5.com1.z0.glb.clouddn.com/blog/mockingbird.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">icepy</h1>
			</hgroup>
			
			<p class="header-subtitle">曾记否，到中流击水，浪遏飞舟！</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/lcepy" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/2455876310" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-CALayer几何" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/07/CALayer几何/" class="article-date">
  	<time datetime="2015-07-07T13:09:43.000Z" itemprop="datePublished">2015-07-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/07/CALayer几何/">CALayer几何</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>了解iOS的几何学，是非常有帮助的，从而可以认识到它是如何控制位置，尺寸以及对自动布局的影响。</p>
<p>UIView和CALayer有三个非常重要的布局属性，frame,bounds和center与position，实际上center和position是一个相同的值，只是为了区分UIView和CALayer。</p>
<p>frame是视图相对于父视图的坐标系，而bounds则是内部坐标，一般情况下{0,0}在内部坐标中描述的是左上角。center和position都代表了相对父视图的anchorPoint所在的位置，anchorPoint的坐标一般情况下都是图层的中心点。</p>
<p>anchorPoint的坐标相对于是你有一张白纸，有一个图钉，在这个白纸的范围内你的图钉一般可以定在中间，左右上下角，而这几个点都可以成为anchorPoint的坐标。</p>
<p>这几个属性是互相影响的，如果你的center或者position坐标变了，也会相应的改变frame和bounds，当然图层还是在原来的高宽组成的矩阵范围之内。</p>
<pre><code><span class="keyword">self</span><span class="variable">.geometryView</span> = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">74</span>, <span class="number">200</span>, <span class="number">200</span>)];
<span class="keyword">self</span><span class="variable">.geometryView</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> grayColor];
[<span class="keyword">self</span><span class="variable">.view</span> addSubview:<span class="keyword">self</span><span class="variable">.geometryView</span>];

<span class="keyword">self</span><span class="variable">.layer</span> = [<span class="built_in">CALayer</span> layer];
<span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.frame</span> = <span class="built_in">CGRectMake</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">100</span>);
<span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.000</span> green:<span class="number">0.502</span> blue:<span class="number">0.502</span> alpha:<span class="number">1.000</span>]<span class="variable">.CGColor</span>;
<span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.borderWidth</span> = <span class="number">1</span>;
<span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.anchorPoint</span> = <span class="built_in">CGPointMake</span>(<span class="number">1</span>, <span class="number">1</span>);
<span class="keyword">self</span><span class="variable">.layer</span><span class="variable">.borderColor</span> = [<span class="built_in">UIColor</span> blackColor]<span class="variable">.CGColor</span>;
[<span class="keyword">self</span><span class="variable">.geometryView</span><span class="variable">.layer</span> addSublayer:<span class="keyword">self</span><span class="variable">.layer</span>];
</code></pre><p>运行这段代码看一看</p>
<p>和视图一样，图层在图层树当中也是相对于父图层的层级关系放置的，如果父图层进行了移动，那么图层也会根据父图层发生移动，也就是意味着position属性可能会发生改变。</p>
<p>这样对于放置图层会更加方便，因为你可以通过移动根图层来将它的子图层作为一个整体来移动，但是有时候你需要知道一个图层的绝对位置，或者是相对于另一个图层的位置，而不是它当前父图层的位置。</p>
<p>CALayer给不同的坐标之间图层提供了一些工具方法，可以进行判断。</p>
<pre><code><span class="tag">-</span> (<span class="tag">CGPoint</span>)<span class="rule"><span class="attribute">convertPoint</span>:<span class="value">(CGPoint)point fromLayer:(CALayer *)layer</span></span>; 
<span class="tag">-</span> (<span class="tag">CGPoint</span>)<span class="rule"><span class="attribute">convertPoint</span>:<span class="value">(CGPoint)point toLayer:(CALayer *)layer</span></span>; 
<span class="tag">-</span> (<span class="tag">CGRect</span>)<span class="rule"><span class="attribute">convertRect</span>:<span class="value">(CGRect)rect fromLayer:(CALayer *)layer</span></span>;
<span class="tag">-</span> (<span class="tag">CGRect</span>)<span class="rule"><span class="attribute">convertRect</span>:<span class="value">(CGRect)rect toLayer:(CALayer *)layer</span></span>;
</code></pre><p>虽然CALayer并不关心任何响应链事件，但是它也提供了一些方法来帮助我们处理事件</p>
<pre><code>-(<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event
{
    <span class="built_in">CGPoint</span> point = [[touches anyObject] locationInView:<span class="keyword">self</span><span class="variable">.view</span>];
    point = [<span class="keyword">self</span><span class="variable">.geometryView</span><span class="variable">.layer</span> convertPoint:point fromLayer:<span class="keyword">self</span><span class="variable">.view</span><span class="variable">.layer</span>];
    <span class="keyword">if</span> ([<span class="keyword">self</span><span class="variable">.geometryView</span><span class="variable">.layer</span> containsPoint:point]) {
        point = [<span class="keyword">self</span><span class="variable">.layer</span> convertPoint:point fromLayer:<span class="keyword">self</span><span class="variable">.geometryView</span><span class="variable">.layer</span>];
        <span class="keyword">if</span> ([<span class="keyword">self</span><span class="variable">.layer</span> containsPoint:point]) {
            [[[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"Inside layer"</span>
                                    message:<span class="literal">nil</span>
                                   delegate:<span class="literal">nil</span>
                          cancelButtonTitle:<span class="string">@"OK"</span>
                          otherButtonTitles:<span class="literal">nil</span>] show];
        } <span class="keyword">else</span> {
            [[[<span class="built_in">UIAlertView</span> alloc] initWithTitle:<span class="string">@"Inside view"</span>
                                    message:<span class="literal">nil</span>
                                   delegate:<span class="literal">nil</span>
                          cancelButtonTitle:<span class="string">@"OK"</span>
                          otherButtonTitles:<span class="literal">nil</span>] show];
        }
    }
}
</code></pre><p>touches系列的方法，可以通过point来探知究竟触摸在图层的哪一个范围内。</p>
<p>相对于这些，图层还有一个三维空间，比如两个图层，谁在上面（可视）谁在下面，zPosition就是来干这个事情的，不过一般很少会使用，你这么设计会比较反人类。想象一下，如果我是一个画家，我在画板上绘画，一般都是后面绘画的画会覆盖在前面绘画的画上，虽然这个属性可以用并且调整，但是我们还是要遵循一下传统，尽量别这么设计。</p>
<p>自从iOS6以来，Apple推出了约束布局，虽然操作视图比如UIView中，可以利用它暴露出来的NSLayoutConstraintAPI，但是CALayer有点麻烦，需要人工，最简单的办法是使用CALayerDelegate。</p>
<pre><code><span class="tag">-</span> (<span class="tag">void</span>)<span class="rule"><span class="attribute">layoutSublayersOfLayer</span>:<span class="value">(CALayer *)layer</span></span>;
</code></pre><p>来进行重新计算坐标系。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-CALayer基础与寄宿图" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/05/CALayer基础与寄宿图/" class="article-date">
  	<time datetime="2015-07-05T05:26:49.000Z" itemprop="datePublished">2015-07-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/05/CALayer基础与寄宿图/">CALayer基础与寄宿图</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>说起来Core Animation是一个复合引擎，它的职责就是尽可能快的组合屏幕上不同的可视内容，这个内容是被分解成独立的图层，存储在一个叫图层树的体系中。如果我们想学习动画，那么一切都从它开始。</p>
<h2 id="CALayer与UIView的区别">CALayer与UIView的区别</h2><p>和UIView最大的不同是CALayer不能处理与用户交互的事件，CALayer并不清楚具体的响应链，即使它提供了一些方法来判断是否触摸在图层的范围内。</p>
<h2 id="CALayer">CALayer</h2><p>CALayer与UIView是一个平行的关系，每一个UIView都存在一个layer属性，视图的职责就是创建并管理这个图层，并且确保当子视图在层级关系中被添加或移除时，它们关联在图层在同样的对应的层级关系树中有同样的操作。（不要急，理论虽然有些绕，慢慢理解）</p>
<pre><code><span class="tag">var</span> layer:CALayer = <span class="function"><span class="title">CALayer</span><span class="params">()</span></span>
layer<span class="class">.frame</span> = <span class="function"><span class="title">CGRectMake</span><span class="params">(<span class="number">50</span>, <span class="number">50</span>, <span class="number">200</span>, <span class="number">200</span>)</span></span>
layer<span class="class">.backgroundColor</span> = <span class="function"><span class="title">UIColor</span><span class="params">(red: <span class="number">0.400</span>, green: <span class="number">0.800</span>, blue: <span class="number">1.000</span>, alpha: <span class="number">1.000</span>)</span></span><span class="class">.CGColor</span>
self<span class="class">.view</span><span class="class">.layer</span><span class="class">.addSublayer</span>(layer)
</code></pre><p>添加一个图层到UIView中，然后运行看看</p>
<p>其实在某种意义上来说，对于一些简单的需求，我们确实没有必要去处理CALayer，那是因为Apple已经通过UIView的高级API间接的使动画变得很简单，使用它何乐而不为呢。</p>
<pre><code>UIView.animateWithDuration<span class="function"><span class="params">(<span class="number">1.2</span>, animations: { () -&gt; Void <span class="keyword">in</span>

})</span></span>
</code></pre><p>那么，我们使用CALayer到底能实现什么UIView不能实现的呢？</p>
<ul>
<li>阴影，圆角，带颜色的边框</li>
<li>3D变换</li>
<li>非矩形范围</li>
<li>透明遮罩</li>
<li>多级非线性动画</li>
</ul>
<h2 id="创建寄宿图">创建寄宿图</h2><p>所谓的寄宿图也就是在图层中包含的图，有了图片，我们可以展现更丰富的视觉效果。</p>
<p>CALayer有一个属性叫contents，这个属性的类型是id类型，而我们要把图片创建在图层上，就需要使用这个属性，当然在Swift中它是一个AnyObject。</p>
<pre><code><span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"mockingbird.png"</span>];
<span class="keyword">self</span><span class="variable">.lodgeLayerView</span><span class="variable">.contents</span> = (__bridge <span class="keyword">id</span>) image<span class="variable">.CGImage</span>;

var image:<span class="built_in">UIImage</span> = <span class="built_in">UIImage</span>(named: <span class="string">"mockingbird.png"</span>)!
layer<span class="variable">.contents</span> = image<span class="variable">.CGImage</span>
</code></pre><p>感觉看起来云豹还算显示正常，万一它有点胖，怎么办呢？如果我们使用UIImageView，那么有contentMode属性可以设置，想一想CALayer是不是也有同样的，遗憾的是，没有，但是它有contentsGravity。</p>
<pre><code>layer<span class="class">.contentsGravity</span> = kCAGravityResizeAspectFill
</code></pre><p>动动你的手指，每一个试一试，看看图片是怎么现实的。</p>
<p>对于双倍屏幕，其实contentsScale属性目前来说已经使用的好少了，它定义了寄宿图的像素尺寸和视图大小的比例，默认情况下它是一个1.0的浮点数。</p>
<p>在某些情况下，我们的云豹已经显示正常大小了，但是你可能发现它超出边界了，那么，亲你能用上maskToBounds属性了，设置为true，它就在边界内了。</p>
<pre><code>layer.<span class="variable">masksToBounds =</span> <span class="constant">true</span>
</code></pre><p>近些年来在用css做网站时，大家都非常流行使用图片精灵的方式去处理图片，为什么？因为它能优化性能。那么在iOS开发中一样可以，我们要用的就是contentsRect属性。</p>
<p>这个坐标系统相对有些绕，因为它采用的是单位坐标，它的值只在0-1之间，用来描述相对位置。</p>
<pre><code>layer<span class="class">.contentsRect</span> = <span class="function"><span class="title">CGRectMake</span><span class="params">(<span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0.5</span>)</span></span>
</code></pre><p>如果我们想使寄宿图可以均匀的拉伸，那么contentsCenter属性是最佳选择，不过要记住一点，它不会主动去拉伸，除非是图层变了。</p>
<pre><code>layer<span class="class">.contentsCenter</span> = <span class="function"><span class="title">CGRectMake</span><span class="params">(<span class="number">0.25</span>, <span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.5</span>)</span></span>
</code></pre><h2 id="自定义图层">自定义图层</h2><pre><code><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">drawLayer</span><span class="params">(layer: CALayer!, inContext ctx: CGContext!)</span></span> {

}
</code></pre><p>Apple的建议是如果你没有这方面的需求，最好不要写一个空的drawLayer方法在你的代码中，因为一旦视图检测到被调用，那么就会分配一个图层。</p>
<p>在这里，我们主要是利用Core Graphics去绘制一些寄宿图，然后添加到上下文中。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-记录第一次创业的挫折经历" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/04/记录第一次创业的挫折经历/" class="article-date">
  	<time datetime="2015-07-04T15:51:45.000Z" itemprop="datePublished">2015-07-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/04/记录第一次创业的挫折经历/">记录第一次创业的挫折经历</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>回想今晚，坐在铁轨上喝着啤酒，脑袋里就想着我哥哥给我说的一句话：意料之中，创业你还太嫩了。呵呵，我以为会这样，我以为会怎样，谁又想到是这样呢？</p>
<ul>
<li>一个人去实地考察，山里面，下暴雨</li>
<li>一个人去跑工商局，问情况</li>
<li>一个人跟乡政府的书记吃饭喝酒，掏了800多</li>
<li>一个人写创业计划书给投资人</li>
<li>一个人写To List 一个月内的</li>
<li>一个人买了农业大学大一到大四的教科书</li>
<li>一个人在做市场调查</li>
<li>一个人在做预算报表</li>
<li>一个人在接待投资人，陪同去实地考察</li>
<li>一个人在写微信端和官网</li>
<li>一个人在做无土栽培和共生系统的实验</li>
</ul>
<p>我都不知道，这是创业吗，还是我来给你们打工的。满腔热血，换来的是冷漠。</p>
<p>看看我跑来的成果，那又怎么样？农业怎么了？不体面吗？我们之间一点契约精神都没，说不搞就不搞撂挑子了。每个人都有自己的小盘算，是，我理解，那又怎么样？每次到了关键时刻，就开始退缩了。</p>
<p>各种理由，你爸妈不想你辞职，我今年还想拿年终奖，我还有点别的事情，那你来创个鬼的业，之前约定好的一起回来，说翻脸就翻脸，又只有我一个人回来。</p>
<p>我哥哥说的对，意料之中，创业你还太嫩了。</p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/action/IMG_0575.JPG" alt=""></p>
<p>如果创业，年终奖这种风险，时间风险，你都承受不了，那你还来创个毛的业，都想赚钱又不想出力，天朝这种好事，怎么就轮不到我呢。</p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/action/IMG_0573.JPG" alt=""></p>
<p>在离开北京时，我们四个人一起商量着能做些什么，于是我们想到了食品安全，我们想做生态农业，想做安全，放心的食材，我们觉得这非常有意义。</p>
<p>我们想到了在雪峰山这个大生态圈中去研究食材，我们想到了如何利用好H5技术去推广，营销，我们想到了如何利用好雪峰山这个生态圈去研究共生系统，我们想到了如何利用好移动互联网去跟需求安全，放心食材的客户对接。于是，我们下了决心，希望能朝着我们预期的目标前进。</p>
<p>在这里，我就犯了自己第一个错误，前期我很主动的去承担了评估的工作，在网上找数据，联系农业专家，给在林业局上班的表哥打电话要来雪峰山的土壤评估，能否去养殖和种植什么，看看市场的行情是怎样的。</p>
<p>我把这些东西整理成了一个小册子，用邮件写给了我的合伙人。</p>
<p>第一步总是美好和圆满的，对于前景我们也很有信心把它做好，而且如果我们做的好还能带动我们的族人一起，这个积极意义就更大了，不是么。</p>
<p>有了第一步的基础，很顺利的进入预估期，开始预估我们能承包多少地，我们的微信端和官方网站的开发周期，我们能种植养殖什么，确定了这一个目标，我们约定好了七月初六月底一起回到家乡，开创我们的事业。</p>
<p>6月23日，我从北京辞职，回到了雪峰山，开始进行筹备工作，到这里为止，噩梦来了。</p>
<hr>
<p>说好的一起回到家乡，却只有我一个人，那么就一个人吧，我又开始迁就我的团队成员，开始了漫长的一个人系列。</p>
<p>最后的结局是什么呢？一个合伙人的家里不允许他回来，因为农业，农民是不体面的工作，如果回来搞这个大学就白读了。一个合伙人希望能拿了年终奖再回来，不想前半年的时间都浪费了。说到这里，前面的好像都白说了，因为我回来了，损失的只是我一个人，前前后后花费的精力和金钱。</p>
<p>哥哥说的那句话，真的很讽刺我，我确实太嫩了。</p>
<p>我记得我们小时候都不是这样的，为什么人长大了，变成了这样。</p>
<p>很希望，我们还是这样的老房子，什么都未变，可是确实变了。</p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/action/IMG_0587.JPG" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/生活/">生活</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-利用AVFoundation实现扫描条码" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/16/利用AVFoundation实现扫描条码/" class="article-date">
  	<time datetime="2015-06-16T09:39:05.000Z" itemprop="datePublished">2015-06-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/16/利用AVFoundation实现扫描条码/">利用AVFoundation实现扫描条码</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>iOS7中添加了一组原生支持扫描的组件，通过AVCaptureMetaDataOutput可以扫描各式各样的QR码，条形码，你所需要做的就是写好UI，并将它设置为AVCaptureSession的输出，再实现相应的协议即可。而且，这玩意可以跟Passbook相结合，有许多潜力可以实现，官方也非常推荐大家使用这个API。</p>
<blockquote>
<p>import AVFoundation</p>
<p>实现 AVCaptureMetadataOutputObjectsDelegate协议</p>
</blockquote>
<p>要实现这个扫描器，首先需要导入AVFoundation框架，这是一个专门处理音频，视频的框架。</p>
<p>创建一个AV设备，使用AVMediaTypeVideo常量</p>
<pre><code>let captureDevice = AVCaptureDevice.<span class="function"><span class="title">defaultDeviceWithMediaType</span><span class="params">(AVMediaTypeVideo)</span></span>
</code></pre><p>然后建立一个输入</p>
<pre><code>let <span class="tag">input</span>:AnyObject! = AVCaptureDeviceInput.<span class="function"><span class="title">deviceInputWithDevice</span><span class="params">(captureDevice, error: &amp;error)</span></span>
</code></pre><p>现在，我们来看一看，最关键的部分，创建输出会话，不过在此之前，我们需要先使用AVCaptureSession创建一个会话，将输入端添加到会话中。</p>
<pre><code><span class="keyword">self</span><span class="variable">.captureSession</span> = <span class="built_in">AVCaptureSession</span>()
<span class="keyword">self</span><span class="variable">.captureSession</span>?<span class="variable">.addInput</span>(input as! <span class="built_in">AVCaptureInput</span>)
</code></pre><p>接着，我们开始使用AVCaptureMetadataOutput创建一个输出端</p>
<pre><code>let captureMetadataOutput = <span class="function"><span class="title">AVCaptureMetadataOutput</span><span class="params">()</span></span>
captureMetadataOutput.<span class="function"><span class="title">setMetadataObjectsDelegate</span><span class="params">(self, queue: dispatch_get_main_queue()</span></span>)
captureMetadataOutput<span class="class">.metadataObjectTypes</span> = [AVMetadataObjectTypeEAN13Code,AVMetadataObjectTypeEAN8Code, AVMetadataObjectTypeCode128Code,AVMetadataObjectTypeQRCode]
</code></pre><p>指定要实现的扫描常量，添加一个协议，GCD可以使用在主线程中，并把它添加到会话中。</p>
<pre><code><span class="tag">self</span><span class="class">.captureSession</span>?<span class="class">.addOutput</span>(<span class="tag">captureMetadataOutput</span>)
</code></pre><p>然后我们还需要使用AVCaptureVideoPreviewLayer创建一个画布，用来显示扫描的展示区域，并添加到当前视图的layer中。</p>
<pre><code><span class="keyword">self</span><span class="variable">.videoPreviewLayer</span> = <span class="built_in">AVCaptureVideoPreviewLayer</span>(session: <span class="keyword">self</span><span class="variable">.captureSession</span>)
<span class="keyword">self</span><span class="variable">.videoPreviewLayer</span>?<span class="variable">.videoGravity</span> = <span class="built_in">AVLayerVideoGravityResizeAspect</span>
<span class="keyword">self</span><span class="variable">.videoPreviewLayer</span>?<span class="variable">.frame</span> = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.bounds</span>
<span class="keyword">self</span><span class="variable">.view</span><span class="variable">.layer</span><span class="variable">.addSublayer</span>(<span class="keyword">self</span><span class="variable">.videoPreviewLayer</span>)
</code></pre><p>最后启动这个会话</p>
<pre><code><span class="tag">self</span><span class="class">.captureSession</span>?<span class="class">.startRunning</span>()
</code></pre><p>到这里，整个扫描条码的程序就已经准备就绪了，但是如果你还需要获取扫描相应的结果，那么需要实现它的协议，并实现func captureOutput(captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [AnyObject]!, fromConnection connection: AVCaptureConnection!) {} 方法。</p>
<p>metadataObjects是一个AnyObject的数组，在这里，还需要进步的判断，获取第一个元素转化为AVMetadataMachineReadableCodeObject，通过type，可以判断扫描的类型，是二维码，还是条形码，还是其他，而值，则是在AVMetadataMachineReadableCodeObject的stringValue属性。</p>
<pre><code><span class="keyword">let</span> metadata = metadataObjects[<span class="number">0</span>] <span class="keyword">as</span>! AVMetadataMachineReadableCodeObject
<span class="comment">//metadata.type</span>
<span class="comment">//metadata.stringValue</span>
</code></pre><p>扫描的Demo可以查看<a href="https://github.com/lcepy/Mockingbird" target="_blank" rel="external">Mockingbird</a></p>
<h2 id="在Objective-C项目中使用">在Objective-C项目中使用</h2><p>runpath $(inherited)@executable_path/Frameworks</p>
<p>三步走图片，可查</p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/iOS/bridging-header-file.png" alt=""></p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/iOS/defines-module-yes.png" alt=""></p>
<p><img src="http://7qncz5.com1.z0.glb.clouddn.com/iOS/import-swift-file.png" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-上架AppStore的经历" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/27/上架AppStore的经历/" class="article-date">
  	<time datetime="2015-05-27T04:43:22.000Z" itemprop="datePublished">2015-05-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/27/上架AppStore的经历/">上架AppStore的经历</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="开发之前的准备">开发之前的准备</h2><p>关于证书，以及流程，前人已有总结，请阅读</p>
<ul>
<li><a href="http://www.jianshu.com/p/6c75a6e53605" target="_blank" rel="external">iOS App提交指南(一)</a></li>
<li><a href="http://www.jianshu.com/p/c7cf65911bc1?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=mobile_author_hots&amp;utm_source=recommendation" target="_blank" rel="external">iOS App提交指南(二)-协议、税务和银行业务</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MjM5OTM0MzIwMQ==&amp;mid=206718165&amp;idx=3&amp;sn=860ec99f81da19cd3d6faffe6d85083b#rd" target="_blank" rel="external">iOS证书说明和发布内购流程整理</a></li>
</ul>
<h2 id="准备开发">准备开发</h2><ul>
<li>在开发码农周刊应用之前，先写了一份PRD，把需求写清楚，然后利用storyboard画了一个简单的原型。PRD List我用的是<a href="https://trello.com/" target="_blank" rel="external">trello</a></li>
<li>图片资源我统一用Images.xcassets来进行管理</li>
<li><a href="http://pixabay.com/" target="_blank" rel="external">pixabay</a>搜索一些免费的资源</li>
<li><a href="http://makeappicon.com/" target="_blank" rel="external">makeappicon</a>生成app的启动icon</li>
<li><a href="https://icons8.com/" target="_blank" rel="external">icons8</a>下载了一份iOS的icon</li>
<li><a href="https://appscreens.io/" target="_blank" rel="external">appscreens</a>这个工具用于生成需要提交到AppStore审核的预览图片</li>
</ul>
<h2 id="准备提交">准备提交</h2><p>在Build Settings Code Signing中设置 Code Signing Identity和Provisioning Profile，用你在apple申请的发布证书和发布描述，然后把Device选择为真机。</p>
<p><img src="http://websources.qiniudn.com/iOS/codsigning.png" alt=""></p>
<p>选择Product中的Archive构建发布版本，可以直接点击Submit to App Store</p>
<p><img src="http://websources.qiniudn.com/iOS/archives.png" alt=""></p>
<h2 id="构建错误与警告">构建错误与警告</h2><p>在构建发布版本时Xcode会检测发布App所具备的逻辑，下面是我遇到的错误和警告</p>
<p>error itms -90096 : your binary is not optimized for iphone5 new iPhone apps and app updates submitted must support the 4-inch display on iphone5 and must include a launch image with the -568h size modifier immediately following the<basename> portion of the launch images’ filename. launch images must be png files and located at the top level of your bundle or provided within each. lproj folder if you localize your launch images learn more about iPhone 5 support and app launch images by reviewing the ‘iOS Human interface guidelines at</basename></p>
<p>上传启动动画PNG图片，另外还给出了三个解决方案参考的URL</p>
<p><a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/IconsImages/IconsImages.html" target="_blank" rel="external">参考一</a><a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/LaunchImages.html#//apple_ref/doc/uid/TP40006556-CH22-SW1" target="_blank" rel="external">参考二</a><a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/IconMatrix.html#//apple_ref/doc/uid/TP40006556-CH27-SW1" target="_blank" rel="external">参考三</a></p>
<p>error itms-4238 redundant binary upload. there already exists a binary upload with build version ‘1’ for train ‘1.0’ at software assets/prereleasesoftwareasset</p>
<p>因为想要提交的版本已经存在，更改build版本号</p>
<p>error itms-90032: invalid image path - no image found at the path referenced under key CFBundleIconFiles:’xxx</p>
<p>存在一个不使用的配置，在Info中删除</p>
<p>WARNING ITMS:iTunes Store operation succeeded with a warning<br>the app references non-public selectors in Payload/manongweekly.app/manongweekly:addContent</p>
<p>查找是否使用了非公用API，一些名字可能会是私有API，最好把名改了</p>
<p>WARNING ITMS 90025:Missing recommended icon file the bundle does not contain an app icon for iPhone/ipodtouch of exactly ‘120x120’pixels in.png format for iOS versions &gt;=7.0</p>
<p>添加76，76@2x的图标PNG</p>
<h2 id="查看被拒原因与加急">查看被拒原因与加急</h2><p>在<a href="https://developer.apple.com/membercenter/index.action" target="_blank" rel="external">Member Center</a>中应用审核的最下面，有一个解决方案中心，点击解决方案中心，可以查看被拒原因，审核人员会给你罗列以及解决方案参考。</p>
<p>如果应用审核通过了，在使用的过程中发现有重大的bug导致应用crash，可以申请加急，非常快，<a href="https://developer.apple.com/appstore/contact/?topic=expedite%3E" target="_blank" rel="external">contact</a></p>
<p>最后《码农周刊》iOS客户端愉快的上线了</p>
<p><a href="https://itunes.apple.com/cn/app/yuan-yi-yue/id990227579?l=en&amp;mt=8" target="_blank" rel="external"><img src="https://camo.githubusercontent.com/770175f6c01d89c84a020706126a9e6399ff76c4/68747470733a2f2f696d672e736869656c64732e696f2f636f636f61706f64732f702f4b696e676669736865722e7376673f7374796c653d666c6174" alt="AppStore"></a>  <a href="https://github.com/lcepy/manong-reading" target="_blank" rel="external"><img src="https://camo.githubusercontent.com/b0224997019dec4e51d692c722ea9bee2818c837/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6d6173686170652f6170697374617475732e737667" alt="manong-reading"></a></p>
<p><a href="https://itunes.apple.com/cn/app/yuan-yi-yue/id990227579?l=en&amp;mt=8" target="_blank" rel="external">Download on the App Store</a> </p>
<p><a href="https://github.com/lcepy/manong-reading" target="_blank" rel="external">checking on the manong-reading project </a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-使用storyboard设计app原型" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/23/使用storyboard设计app原型/" class="article-date">
  	<time datetime="2015-05-23T12:48:13.000Z" itemprop="datePublished">2015-05-23</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/23/使用storyboard设计app原型/">使用storyboard设计app原型</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天我想写一下自己利用storyboard+swift快速设计一款App原型的经历，这是突然发现Xcode的强大之处带来的优势，你可以设计一个如下图的原型。</p>
<p><img src="http://websources.qiniudn.com/iOS/prototype.png" alt=""></p>
<p>先创建一个项目＋创建一个storyboard＋拖拽一个ViewController到storyboard中（默认你知道怎么创建一个项目，怎么新建一个storyboard，以及怎么拖拽一个ViewController到storyboard中）</p>
<p><img src="http://websources.qiniudn.com/iOS/storyboard.png" alt=""></p>
<p>给ViewController设置启动，这个设置针对storyboard是唯一的，也就是只能设置一个</p>
<p><img src="http://websources.qiniudn.com/iOS/initViewController.png" alt=""></p>
<p>给ViewController设置身份ID(identity)，它应该是唯一的，而且后期如果有多个storyboard时场景的跳转会使用到</p>
<pre><code>var <span class="string">sd:</span>UIStoryboard = UIStoryboard(<span class="string">name:</span> <span class="string">"Cycling"</span>, <span class="string">bundle:</span> nil)
var <span class="string">cyc:</span>CyclingInitViewController = sd.instantiateViewControllerWithIdentifier(<span class="string">"CyclingInit"</span>) <span class="keyword">as</span>! CyclingInitViewController
self.navigationController?.pushViewController(cyc, animated: <span class="literal">true</span>)
</code></pre><p><img src="http://websources.qiniudn.com/iOS/identity.png" alt=""></p>
<p>给ViewController应用一个NavgationController，每一个视图控制器中都有一个navigationController和navigationItem。（注意：前者应该算一个公共的，后者navigationItem是每个控制器自身独有的）在使用的时候需要注意这些，以保证标题，以及导航栏上的bar可以设置正确</p>
<p><img src="http://websources.qiniudn.com/iOS/navigationC.png" alt=""></p>
<p>拖拽一个label到视图中，我们可以通过属性板来设置它的一些属性，比如字体大小，颜色，是否居中。属性有很多，基本上和代码中的UILabel可以一一对应起来。</p>
<p><img src="http://websources.qiniudn.com/iOS/attributes.png" alt=""></p>
<p>在Size面板中可以调整x,y以及高宽</p>
<p><img src="http://websources.qiniudn.com/iOS/size.png" alt=""></p>
<p>接下来应该是一个最重要的活儿了，autolayout技术对视图进行约束，这是接下来想对UI进行正确排版所使用的技术，关于它的细节问题，你需要慢慢了解，我只能告诉你怎样在storyboard中利用Xcode给我们提供的工具去连线，去进行约束。</p>
<p>第一种方式，利用右下角的小三角形，对约束进行重置（简单的约束，Xcode非常智能的帮你排版了）</p>
<p><img src="http://websources.qiniudn.com/iOS/constraintsimage.png" alt=""></p>
<p>第二种方式，利用连线去设置constraints，属性比较多，可以记一下，上下左右高宽都有，还有居中什么的</p>
<p><img src="http://websources.qiniudn.com/iOS/constraints3.png" alt=""></p>
<p>第三种方式，利用代码去设置constraints（一般来说，我们是在设计原型，如果用代码…感觉杀鸡焉用牛刀了）推荐一个库<a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">Masonry</a>（注明：现在还没有swift版的）</p>
<p>最后大家看看我们设计的一个结果吧，源代码可以在Github上查看<a href="https://github.com/lcepy/storyboard-app-prototype" target="_blank" rel="external">storyboard-app-prototype</a></p>
<p><img src="http://websources.qiniudn.com/iOS/result.png" alt=""></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-使用Worker实现一个多线程数据缓存模块" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/20/使用Worker实现一个多线程数据缓存模块/" class="article-date">
  	<time datetime="2015-05-20T08:24:18.000Z" itemprop="datePublished">2015-05-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/20/使用Worker实现一个多线程数据缓存模块/">使用Worker实现一个多线程数据缓存模块</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Worker是一个可以在后台运行的任务，并提供了一个JavaScript接口让我们来使用它。Worker能够被轻松的创建，还能向它的创建者发送消息。 你只要调用 Worker() 构造函数，指定一个需要运行在 worker 线程内的脚本，就能够很容易的创建一个 worker。</p>
<p>Worker这个API的使用非常的简单</p>
<ul>
<li>postMessage()  向worker内部发送消息</li>
<li>terminate() 立即停止当前的worker</li>
<li>onmessage 一个消息事件，worker内部向前台发送消息 </li>
<li>onerror 一个错误事件，运行环境出错时，worker内部向前台发送消息</li>
</ul>
<p>属性</p>
<ul>
<li>message 一个可读的错误消息</li>
<li>filename 错误所在的文件名</li>
<li>lineno 错误所在的文本行号 </li>
</ul>
<p>JavaScript Client Code</p>
<pre><code><span class="keyword">var</span> workerQueue = [];
<span class="keyword">var</span> cacheSystem = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
    <span class="keyword">var</span> isWork         = !!Worker;
    <span class="keyword">var</span> dataSource     = {};
    <span class="keyword">var</span> contains     = [];
    <span class="keyword">var</span> lock        = <span class="literal">false</span>;
    <span class="keyword">var</span> count         = <span class="number">0</span>;
    <span class="keyword">var</span> getDash     = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
        <span class="keyword">var</span> dash         = localStorage.getItem(<span class="string">'scanUseDashDataSource'</span>);
        <span class="keyword">var</span> dashData     = dash ? <span class="built_in">JSON</span>.parse(dash).data : contains;
        <span class="keyword">return</span> dashData; 
    }
    <span class="keyword">return</span>    {
        allObject:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
            <span class="keyword">var</span> d = localStorage.getItem(<span class="string">'scanUseModalDataSource'</span>);
            <span class="keyword">return</span> d ? d = <span class="built_in">JSON</span>.parse(d).data : <span class="literal">null</span>;
        },
        objectForKey:<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>{
            <span class="keyword">return</span> <span class="keyword">this</span>.allObject()[key];
        },
        allKeys:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
            <span class="keyword">var</span> o = <span class="keyword">this</span>.allObject();
            <span class="keyword">return</span> o ? <span class="built_in">Object</span>.keys(o) : contains;
        },
        allValues:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
            <span class="keyword">var</span> o = <span class="keyword">this</span>.allObject();
            <span class="keyword">if</span>(!o){
                <span class="keyword">return</span> contains;
            }
            <span class="keyword">var</span> c = [];
            <span class="keyword">for</span>(<span class="keyword">var</span> k <span class="keyword">in</span> o){
                c.push(o[k].data);
            }
            <span class="keyword">return</span> c;
        },
        allDash:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
            <span class="keyword">return</span> getDash();
        },
        setObject:<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>{
            <span class="keyword">var</span> s             = <span class="keyword">this</span>;
            <span class="keyword">var</span> metadata     = <span class="keyword">this</span>.allObject() || {};
            metadata[value] = {<span class="string">"data"</span>:<span class="literal">null</span>,<span class="string">"work"</span>:<span class="literal">false</span>,<span class="string">"error"</span>:<span class="literal">false</span>};
            <span class="keyword">var</span> dashData     = <span class="keyword">this</span>.allDash();    
            <span class="comment">//如果有网络，提交给后台线程去处理网络请求</span>
            <span class="built_in">window</span>.networkState = <span class="number">1</span>;
            <span class="keyword">if</span>(isWork &amp;&amp; <span class="built_in">window</span>.networkState &gt; <span class="number">0</span>){
                <span class="keyword">var</span> worker = <span class="keyword">new</span> Worker(<span class="string">'fetchThread.js'</span>);
                worker.addEventListener(<span class="string">'message'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>{
                    <span class="built_in">console</span>.log(evt);
                    <span class="keyword">var</span> obj = s.allObject();
                    <span class="keyword">var</span> sp     = evt.data.split(<span class="string">'@icepy-&gt;'</span>);
                    <span class="keyword">var</span> tag = sp[<span class="number">0</span>];
                    <span class="keyword">var</span> dat = sp[<span class="number">1</span>];
                    <span class="keyword">var</span> o   = obj[tag];
                    <span class="keyword">var</span> r   = <span class="built_in">JSON</span>.parse(dat);
                    <span class="keyword">if</span>(o){
                        <span class="comment">//把后台得到的数据添加到data中</span>
                        o.data     = r;
                        <span class="comment">//标记work已经完成</span>
                        o.work  = <span class="literal">true</span>;
                        <span class="comment">//标记执行线程锁</span>
                        lock     = <span class="literal">false</span>;
                        <span class="keyword">if</span>(r.error){
                            o.error = <span class="literal">true</span>;
                        }
                        localStorage.setItem(<span class="string">'scanUseModalDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:obj}));
                        workerQueue[count][<span class="number">2</span>] = <span class="literal">true</span>;
                        count++;
                        <span class="keyword">var</span> work = workerQueue[count];
                        <span class="keyword">if</span>(work){
                            <span class="keyword">if</span>(work[<span class="number">2</span>]){
                                <span class="keyword">var</span> i = count++;
                                <span class="keyword">var</span> f = <span class="literal">true</span>;
                                <span class="keyword">do</span>{
                                    <span class="keyword">var</span> _work = workerQueue[i];
                                    <span class="keyword">if</span>(!_work[<span class="number">2</span>]){
                                        _work[<span class="number">1</span>].postMessage(_work[<span class="number">0</span>]);
                                        f = <span class="literal">false</span>;
                                        count = i;
                                        <span class="keyword">break</span>;
                                    }
                                    i++;
                                }<span class="keyword">while</span>(f);
                            }<span class="keyword">else</span>{
                                work[<span class="number">1</span>].postMessage(work[<span class="number">0</span>]);
                            }
                        }<span class="keyword">else</span>{
                            workerQueue.length = <span class="number">0</span>;
                            count = <span class="number">0</span>;
                        }
                    }

                });
                worker.addEventListener(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">evt</span>)</span>{
                    <span class="built_in">console</span>.log(<span class="string">'错误信息处理'</span>);
                });
                <span class="comment">//把线程加入队列</span>
                workerQueue.push([value,worker,<span class="literal">false</span>]);
                <span class="keyword">if</span>(!lock){
                    lock = <span class="literal">true</span>;
                    worker.postMessage(value);
                }
            }
            <span class="keyword">if</span>(!(dashData.indexOf(value) &gt; -<span class="number">1</span>)){
                dashData.push(value);
            }
            localStorage.setItem(<span class="string">'scanUseDashDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:dashData}));
            localStorage.setItem(<span class="string">'scanUseModalDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:metadata}));
        },
        setValue:<span class="function"><span class="keyword">function</span>(<span class="params">key,value</span>)</span>{
            <span class="keyword">var</span> metadata = <span class="keyword">this</span>.allObject();
            metadata[key].data = value.concat();
            metadata[key].work = <span class="literal">true</span>;
            localStorage.setItem(<span class="string">'scanUseModalDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:metadata}));
        },
        removeObjectForKey:<span class="function"><span class="keyword">function</span>(<span class="params">key</span>)</span>{
            <span class="keyword">var</span> metadata     = <span class="keyword">this</span>.allObject();
            <span class="keyword">var</span> dash         = <span class="keyword">this</span>.allDash();
            dash.splice(dash.indexOf(key),<span class="number">1</span>);
            <span class="keyword">this</span>.pop(key);
            <span class="keyword">delete</span> metadata[key];
            localStorage.setItem(<span class="string">'scanUseDashDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:dash}));
            localStorage.setItem(<span class="string">'scanUseModalDataSource'</span>,<span class="built_in">JSON</span>.stringify({<span class="string">"data"</span>:metadata}));
        },
        repeat:<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>{
            <span class="keyword">var</span> d = <span class="keyword">this</span>.allKeys();
                i = <span class="number">0</span>;
            <span class="keyword">if</span>(!d.length){
                <span class="keyword">return</span> <span class="literal">false</span>;
            }<span class="keyword">else</span>{
                <span class="keyword">var</span> lock = <span class="literal">false</span>;
                <span class="keyword">if</span>(d.indexOf(v) &gt; -<span class="number">1</span>){
                    lock = <span class="literal">true</span>;
                }
                <span class="keyword">return</span> lock;
            }
        },
        pop:<span class="function"><span class="keyword">function</span>(<span class="params">key,d</span>)</span>{
            <span class="keyword">if</span>(!d){
                d = <span class="keyword">this</span>.allObject();
            }
            <span class="keyword">if</span>(isWork){
                <span class="keyword">var</span> i = <span class="number">0</span>;
                <span class="keyword">var</span> e = workerQueue.length;
                <span class="keyword">if</span>(e &gt; <span class="number">0</span>){
                    <span class="keyword">for</span>(;i&lt;e;i++){
                        <span class="keyword">var</span> work = workerQueue[i];
                        <span class="keyword">if</span>(work &amp;&amp; work[<span class="number">0</span>] === key){
                            work[<span class="number">2</span>] = <span class="literal">true</span>;
                            work[<span class="number">1</span>].terminate();
                            <span class="keyword">break</span>;
                        }
                    }
                }
            }
        },
        isWork:isWork
    }
}();
</code></pre><p>JavaScript Thread Code</p>
<pre><code>addEventListener<span class="list">(<span class="quoted">'message</span>',function<span class="list">(<span class="keyword">evt</span>)</span>{
    var parameter     = evt.data<span class="comment">;</span>
    var xhr         = new XMLHttpRequest<span class="list">()</span><span class="comment">;</span>
    var headers        = {}<span class="comment">;</span>
    xhr.onreadystatechange = function<span class="list">(<span class="keyword">e</span>)</span>{
           if<span class="list">(<span class="keyword">xhr</span>.readyState === <span class="number">4</span>)</span>{
               clearInterval<span class="list">(<span class="keyword">abortTimeout</span>)</span><span class="comment">;</span>
               if<span class="list">(<span class="list">(<span class="keyword">xhr</span>.status &gt;= <span class="number">200</span> <span class="keyword">&amp;&amp;</span> xhr.status &lt; <span class="number">300</span>)</span> || xhr.status == <span class="number">304</span>)</span>{
                   postMessage<span class="list">(<span class="keyword">parameter+</span>'@icepy-&gt;<span class="quoted">'+xhr</span>.responseText)</span><span class="comment">;</span>
                   close<span class="list">()</span><span class="comment">;</span>
               }
           }
       }
    xhr.open<span class="list">(<span class="quoted">'POST</span>',<span class="quoted">'http</span><span class="keyword">://127</span>.<span class="number">0.0</span>.<span class="number">1</span>:<span class="number">8001</span>/',true)</span><span class="comment">;</span>
       xhr.send<span class="list">(<span class="keyword">parameter</span>)</span><span class="comment">;</span>
       var abortTimeout = setInterval<span class="list">(<span class="keyword">function</span><span class="list">()</span>{
           xhr.abort<span class="list">()</span><span class="comment">;</span>
           postMessage<span class="list">(<span class="keyword">parameter+</span>'@icepy-&gt;<span class="quoted">'+</span>'{<span class="string">"error"</span>:<span class="string">"timeout"</span>}')</span><span class="comment">;</span>
           close<span class="list">()</span><span class="comment">;</span>
       },<span class="number">1000</span><span class="variable">*13);

       xhr.onerror = function(e){
           postMessage(parameter+'@icepy-&gt;'+'{"error":"notnetwork"}');
           close();
       }     
});</span></span></span>
</code></pre><p>阅读资料</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker" target="_blank" rel="external">https://developer.mozilla.org/zh-CN/docs/Web/API/Worker</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-NSDictionary" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/16/NSDictionary/" class="article-date">
  	<time datetime="2015-05-16T11:20:01.000Z" itemprop="datePublished">2015-05-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/16/NSDictionary/">NSDictionary</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>使用字典，能很好的组织数据，OC中的字典有三种方式</p>
<pre><code><span class="comment">//创建字典</span>
<span class="built_in">NSDictionary</span> *dic = [[<span class="built_in">NSDictionary</span> alloc] initWithObjectsAndKeys:<span class="string">@"value"</span>,<span class="string">@"key"</span>,<span class="string">@"github"</span>,<span class="string">@"build"</span>, <span class="literal">nil</span>];
<span class="built_in">NSDictionary</span> *dic1 = @{<span class="string">@"key1"</span>:<span class="string">@"value1"</span>};
<span class="built_in">NSDictionary</span> *dic2 = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:<span class="string">@"value2"</span>,<span class="string">@"key2"</span>, <span class="literal">nil</span>];
</code></pre><p>包含多少个键值对</p>
<pre><code><span class="comment">//包含多少个键值对</span>
<span class="function">NSLog</span>(<span class="at_rule">@<span class="string">"%zd"</span>,dic.count);</span>
</code></pre><p>通过已知的key名来获取值</p>
<pre><code><span class="comment">//已知key来获取值</span>
NSString *<span class="keyword">value</span> = [dic objectForKey:@<span class="string">"key"</span>];
NSLog(@<span class="string">"%@"</span>,<span class="keyword">value</span>);
</code></pre><p>获取所有的key和获取所有的值</p>
<pre><code><span class="comment">//获取所有的key名或者值，返回一个不可变数组</span>
<span class="built_in">NSArray</span> *keys = [dic allKeys];
<span class="built_in">NSArray</span> *values = [dic allValues];
<span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,keys);
<span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,values);
</code></pre><p>通过一个数组key获取值</p>
<pre><code>NSArray *vals = [dic <span class="string">objectsForKeys:</span>@[@<span class="string">"key"</span>] <span class="string">notFoundMarker:</span>@<span class="string">"not"</span>];
NSLog(@<span class="string">"%@"</span>,vals);
</code></pre><p>遍历</p>
<pre><code><span class="list">[<span class="keyword">dic</span> enumerateKeysAndObjectsUsingBlock:^<span class="list">(<span class="keyword">id</span> key, id obj, BOOL *stop)</span> {
    NSLog<span class="list">(<span class="keyword">@</span><span class="string">"%@"</span>,key)</span><span class="comment">;</span>
    NSLog<span class="list">(<span class="keyword">@</span><span class="string">"%@"</span>,obj)</span><span class="comment">;</span>
}]<span class="comment">;</span></span>
</code></pre><p>排序</p>
<pre><code><span class="built_in">NSArray</span> *kesArray =  [dic keysSortedByValueUsingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span> obj1, <span class="keyword">id</span> obj2) {
    <span class="built_in">NSString</span> *ke1 = obj1;
    <span class="built_in">NSString</span> *ke2 = obj2;
    <span class="keyword">return</span> [ke1 compare:ke2];
}];
</code></pre><p>过滤</p>
<pre><code><span class="collection">[dic keysOfEntriesPassingTest:&lt;#<span class="comment">^BOOL</span><span class="list">(<span class="keyword">id</span> key, id obj, BOOL *stop)</span>predicate#&gt;]</span><span class="comment">;</span>
</code></pre><p>Mutable版的字典，多了增删的方法</p>
<pre><code><span class="built_in">NSMutableDictionary</span> *dicmutable = [<span class="built_in">NSMutableDictionary</span> dictionaryWithDictionary:dic];
</code></pre><p>添加</p>
<pre><code><span class="list">[<span class="keyword">dicmutable</span> setObject:@<span class="string">"icepy"</span> forKey:@<span class="string">"io"</span>]<span class="comment">;</span>
NSLog<span class="list">(<span class="keyword">@</span><span class="string">"%@"</span>,dicmutable)</span><span class="comment">;</span></span>
</code></pre><p>删除</p>
<pre><code><span class="list">[<span class="keyword">dicmutable</span> removeObjectForKey:@<span class="string">"build"</span>]<span class="comment">;</span>
NSLog<span class="list">(<span class="keyword">@</span><span class="string">"%@"</span>,dicmutable)</span><span class="comment">;</span></span>
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-iOS动画基础" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/10/iOS动画基础/" class="article-date">
  	<time datetime="2015-05-09T17:02:06.000Z" itemprop="datePublished">2015-05-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/10/iOS动画基础/">iOS动画基础</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>貌似在哪个领域里，动画的实现都赋予了软件非常生动的交互，所以我们必须要掌握并学好它。在学习动画之前，首推<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="external">Core Animation Programming Guide</a>核心动画编程指南，去了解一下官方的术语，定义，以及指导，这很有帮助。</p>
<p>顾名思义，动画也就是让我们的view可以动起来，所谓的view实际上都会继承于UIView，而每一个UIView都有一个CALayer对象，它们两个是分开的，分别用于不同的地方。可以看见的是，UIView用于显示，CALayer用于绘制。（注明：CALayer属于QuartzCore框架）</p>
<p>UIView自身（注明：UIView属于UIKit框架）会有描述位置的信息，比如frame，transform。在使用一些比较简单的动画时，我们应该首选考虑的是使用UIView提供的一些方法，去改变frame，transform等属性。</p>
<pre><code><span class="collection">[UIView animateWithDuration:1.6 animations:<span class="comment">^{

}</span>]</span><span class="comment">;</span>
</code></pre><p>对于高度复杂一些的动画，就需要我们对Core Animation整个的熟悉和了解了。这里，我建议先阅读一下<a href="http://objccn.io/issue-12-1/" target="_blank" rel="external">动画理解</a>，把一些概念性的东西了解清楚。比如Core Animation维护的层次结构，什么叫模型层树(model layer tree)，什么叫表现层树(presentation layer tree)，而且你务必要理解，当把动画添加到一个layer的时候，是不直接修改其属性的。</p>
<p>在清楚这些概念性的问题后，你可以去学习一些动画类了，比如CABasicAnimation，CATransform3D，CAKeyframeAnimation,CAAnimationGroup,CAAnimation，另外你务必要记住一点，CAAnimation是这些动画类的鼻祖(它是一个抽象类，不能直接使用)，而且要搞清楚CALayer。</p>
<p>举例一些简单的例子</p>
<p><strong>使用CABasicAnimation</strong></p>
<pre><code>CABasicAnimation *<span class="variable">animation =</span> [CABasicAnimation animation];
animation.<span class="variable">keyPath =</span> @<span class="string">"position.x"</span>;
animation.<span class="variable">duration =</span> <span class="number">1</span>;
animation.<span class="variable">fromValue =</span> @<span class="number">50</span>;
animation.<span class="variable">toValue =</span> @<span class="number">250</span>;
[view.layer addAnimation:animation forKey:@<span class="string">"left"</span>];
</code></pre><p>为了验证动画究竟修改了那个地方的值，我打印了一下view的frame，NSLog(@”%@”,NSStringFromCGRect(view.frame))，这里可以看的出来，view的frame值没有发生改变，而且在模拟器中，动画结束了，view又回到了原来的位置。说明啊，动画的执行和view的渲染是分开的，如果你还不理解，请继续阅读《核心动画编程指南》或者简单的《动画理解》。</p>
<p>如果我们不想动画结束后view回到原来的位置，可以使用</p>
<pre><code>animation.fillMode = kCAFillModeForwards<span class="comment">;</span>
animation.removedOnCompletion = NO<span class="comment">;</span>
</code></pre><p><strong>使用CAKeyframeAnimation</strong></p>
<pre><code>CAKeyframeAnimation *animation = [CAKeyframeAnimation animation]<span class="comment">;</span>
animation.keyPath = @<span class="string">"position.x"</span><span class="comment">;</span>
animation.values = @[<span class="localvars">@0</span>,<span class="localvars">@10</span>,@-<span class="number">10</span>,<span class="localvars">@10</span>,<span class="localvars">@0</span>]<span class="comment">;</span>
animation.keyTimes = @[ <span class="localvars">@0</span>, @(<span class="number">1</span> / <span class="number">6.0</span>), @(<span class="number">3</span> / <span class="number">6.0</span>), @(<span class="number">5</span> / <span class="number">6.0</span>), <span class="localvars">@1</span> ]<span class="comment">;</span>
animation.duration = <span class="number">0.4</span><span class="comment">;</span>
animation.additive = YES<span class="comment">;</span>
[view.layer addAnimation:animation forKey:@<span class="string">"shake"</span>]<span class="comment">;</span>
</code></pre><p><strong>使用CAAnimationGroup</strong></p>
<pre><code>CABasicAnimation *right = <span class="comment">[CABasicAnimation animation]</span>;
right.keyPath = @<span class="string">"position.x"</span>;
right.duration = 1;
right.toValue = @250;
right.timingFunction = <span class="comment">[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut]</span>;

CABasicAnimation *top = <span class="comment">[CABasicAnimation animation]</span>;
top.keyPath = @"position.y";
top.duration = 1;
top.toValue = @10;
right.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseOut];

CAAnimationGroup *animationsGroup = <span class="comment">[CAAnimationGroup animation]</span>;
animationsGroup.animations = @<span class="comment">[right,top]</span>;
<span class="comment">[view.layer addAnimation:animationsGroup forKey:@"group"]</span>;
</code></pre><p>阅读资料：</p>
<ul>
<li><a href="http://objccn.io/issue-12/" target="_blank" rel="external">#12动画</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/CoreAnimation_framework/index.html#//apple_ref/doc/uid/TP40004513" target="_blank" rel="external">Core Animation Reference Collection</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-CoreData的使用" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/05/05/CoreData的使用/" class="article-date">
  	<time datetime="2015-05-05T02:31:04.000Z" itemprop="datePublished">2015-05-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/05/CoreData的使用/">CoreData的使用</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CoreData是Cocoa中处理数据，绑定数据的一个框架，如果不靠谱数据的平台一致性（iOS，Android），完全可以使用它替代SQLite。虽然，iOS也有一个C实现的SQLite库，但是语法层面比较琐碎，而且使用的是C函数。如果要使用，大家可以选择使用一个开源的库来替代<a href="https://github.com/ccgus/fmdb" target="_blank" rel="external">Obje-C版</a>和<a href="https://github.com/FahimF/SQLiteDB" target="_blank" rel="external">Swift版</a></p>
<p>从代码层面上来看，要创建一个CoreData实例，需要四个步骤</p>
<ul>
<li>创建数据库文件的物理地址</li>
<li>创建模型托管对象</li>
<li>创建持久化存储调度器</li>
<li>创建上下文</li>
</ul>
<p>正常情况下，上述四个步骤，我们只使用一次，建议惰性加载它</p>
<pre><code>-(<span class="built_in">NSManagedObjectContext</span> *)context
{
    <span class="keyword">if</span> (!_context) {
        <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;
        <span class="comment">//创建db url</span>
        <span class="built_in">NSString</span> *dbPath = [<span class="keyword">self</span><span class="variable">.baseDoc</span> stringByAppendingPathComponent:<span class="string">@"manong.db"</span>];
        <span class="built_in">NSURL</span> *dbUrl = [<span class="built_in">NSURL</span> fileURLWithPath:dbPath];
        <span class="comment">//创建模型托管对象</span>
        <span class="built_in">NSManagedObjectModel</span> *model = [<span class="built_in">NSManagedObjectModel</span> mergedModelFromBundles:<span class="literal">nil</span>];
        <span class="comment">//创建持久化存储调度器</span>
        <span class="built_in">NSPersistentStoreCoordinator</span> *store = [[<span class="built_in">NSPersistentStoreCoordinator</span> alloc] initWithManagedObjectModel:model];
        [store addPersistentStoreWithType:<span class="built_in">NSSQLiteStoreType</span> configuration:<span class="literal">nil</span> URL:dbUrl options:<span class="literal">nil</span> error:&amp;error];
        <span class="comment">//创建上下文</span>
        _context = [[<span class="built_in">NSManagedObjectContext</span> alloc] init];
        [_context setPersistentStoreCoordinator:store];
    }
    <span class="keyword">return</span> _context;
}
</code></pre><p>下面给出一张关系图</p>
<p><img src="http://websources.qiniudn.com/iOS/CoreData类关系图.png" alt="CoreData类关系图"></p>
<p>从上述的图中，其实可以看到一些有关系的模块</p>
<ul>
<li>Managed Object Model 用于描述数据模型，这里包括实体，属性，请求等</li>
<li>Managed Object Context 参与对数据对象进行各项操作的上下文</li>
<li>Managed Object 数据对象（用户使用的对象与上下文有关联）</li>
<li>Persistent Store 相当于数据库文件的管理器，处理底层对数据库文件的读取与写入</li>
</ul>
<p><strong>基本上创建一个Managed Object文件不需要自己去手动创建，而且建议Xcode帮助我们创建的model文件不要修改</strong></p>
<p>如果非要自己创建的话，那么继承NSManagedObject类吧</p>
<pre><code><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span>
<span class="preprocessor">#import <span class="title">&lt;CoreData/CoreData.h&gt;</span></span>

<span class="class"><span class="keyword">@interface</span> <span class="title">ManongTag</span> : <span class="title">NSManagedObject</span></span>

<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, retain) <span class="built_in">NSNumber</span> * contentCount;
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, retain) <span class="built_in">NSString</span> * tagKey;
<span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, retain) <span class="built_in">NSString</span> * tagName;

<span class="keyword">@end</span>
</code></pre><h1 id="下面给出一张实际的操作图，如何使用CoreData。">下面给出一张实际的操作图，如何使用CoreData。</h1><p><img src="http://websources.qiniudn.com/iOS/CoreData操作图形化.jpg" alt="CoreData操作图形化"> </p>
<ul>
<li>首先add Entity添加一个实体</li>
<li>然后在Attributes中添加相应的属性，在Type中选择相应的数据类型</li>
<li>Pelationships可以对实体进行关联，比如ManongTitle实体中关联了一个ManongContent实体</li>
<li>&lt;橘黄色箭头&gt;可以设置多关联，在使用的时候它会是一个NSSet集合</li>
<li>Style可以查看设计图</li>
</ul>
<p>如果想新增一条数据，需要三个步骤才能实现，第一先创建一个实体描述，第二创建一个ManagedObject对象，第三给上下文的save方法发送消息。</p>
<pre><code><span class="built_in">NSEntityDescription</span> *mnTag = [<span class="built_in">NSEntityDescription</span> entityForName:<span class="string">@"ManongTag"</span> inManagedObjectContext:<span class="keyword">self</span><span class="variable">.context</span>];
ManongTag *manongTag = [[ManongTag alloc] initWithEntity:mnTag insertIntoManagedObjectContext:<span class="keyword">self</span><span class="variable">.context</span>];
manongTag<span class="variable">.tagKey</span> = tagKey;
manongTag<span class="variable">.tagName</span> = tagNmae;
<span class="built_in">NSError</span> *error = <span class="literal">nil</span>;
<span class="built_in">BOOL</span> success;
[<span class="keyword">self</span><span class="variable">.context</span> save:&amp;error];
success = error ? <span class="literal">NO</span> : <span class="literal">YES</span>;
</code></pre><p>如果想在实体中查询数据，一般情况下两个步骤，如果是条件查询最少三个步骤，第一创建一个查询请求，第二创建一个谓词对象，第三给上下文的executeFetchRequest方法发送消息。</p>
<pre><code><span class="comment">//查询所有的数据</span>
<span class="built_in">NSFetchRequest</span> *request = [[<span class="built_in">NSFetchRequest</span> alloc] initWithEntityName:<span class="string">@"ManongDigest"</span>];
<span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span><span class="variable">.context</span> executeFetchRequest:request error:&amp;error];

<span class="comment">//条件查询</span>
<span class="built_in">NSFetchRequest</span> *request = [[<span class="built_in">NSFetchRequest</span> alloc] initWithEntityName:@“ManongDigest”];
<span class="built_in">NSPredicate</span> *dicate = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"%K BEGINSWITH[c] %@"</span>,<span class="string">@"tagName"</span>,<span class="string">@"a"</span>];
<span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span><span class="variable">.context</span> executeFetchRequest:request error:&amp;error];
</code></pre><p>如果想更新某一条数据，正常情况下三个步骤，第一创建一个查询请求，第二修改MangedObject对象的属性，第三给上下文的save方法发送消息。</p>
<pre><code><span class="built_in">NSFetchRequest</span> *request = [[<span class="built_in">NSFetchRequest</span> alloc] initWithEntityName:<span class="string">@"ManongDigest"</span>];
<span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span><span class="variable">.context</span> executeFetchRequest:request error:&amp;error];
<span class="keyword">for</span>(ManongDigest *digest <span class="keyword">in</span> arr)
{
    digest<span class="variable">.tagName</span> = <span class="string">@"lcepy"</span>;
}
<span class="built_in">NSError</span> *error = <span class="literal">nil</span>;
[<span class="keyword">self</span><span class="variable">.context</span> save:&amp;error];
<span class="keyword">if</span> (error) {
    <span class="keyword">return</span> <span class="literal">NO</span>;
}<span class="keyword">else</span>{
    <span class="keyword">return</span> <span class="literal">YES</span>;
}
</code></pre><p>如果想删除某一条数据</p>
<pre><code><span class="built_in">NSFetchRequest</span> *request = [[<span class="built_in">NSFetchRequest</span> alloc] initWithEntityName:<span class="string">@"ManongDigest"</span>];
<span class="built_in">NSArray</span> *arr = [<span class="keyword">self</span><span class="variable">.context</span> executeFetchRequest:request error:&amp;error];
<span class="keyword">if</span>(arr<span class="variable">.count</span>){
    ManongDigest *digest = (ManongDigest *)arr[<span class="number">0</span>];
    [<span class="keyword">self</span><span class="variable">.context</span> deleteObject:digest];
}
</code></pre><p>上述四种操作方式是最常用的，当然CoreData 的API肯定不止这四种，但是使用的逻辑思维基本上是，查询－处理－使用上下文或者创建实体－处理－使用上下文。</p>
<p>这个框架算比较复杂的一个，学习起来曲线也比较大，需要耐心。</p>
<p>参考资料</p>
<ul>
<li><a href="http://www.objc.io/issue-4/" target="_blank" rel="external">objc-CoreData</a></li>
<li><a href="http://objccn.io/issue-4-2/" target="_blank" rel="external">一个完整的 Core Data 应用</a></li>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/CoreData_ObjC/index.html" target="_blank" rel="external">Core Data API</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSPredicate_Class/" target="_blank" rel="external">NSPredicate API</a></li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 icepy
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>